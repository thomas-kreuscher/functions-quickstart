trigger:
  branches:
    include:
      - master   # oder main

pool:
  name: SelfHostedPool

steps:
- script: echo "Deploying commit $(Build.SourceVersion) to Function App"
  displayName: 'Agent-Check'

# Paket erstellen: Inhalte des Repo-Roots zippen
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(Build.SourcesDirectory)'
    includeRootFolder: false
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)/functions.zip'
    replaceExistingArchive: true

# Debug: ZIP-Inhalt pr√ºfen
- powershell: |
    Expand-Archive -Path "$(Build.ArtifactStagingDirectory)/functions.zip" -DestinationPath "$(Build.ArtifactStagingDirectory)/unzipped"
    Get-ChildItem -Recurse "$(Build.ArtifactStagingDirectory)/unzipped"
  displayName: 'Check ZIP contents'

# Deploy mit AzureWebApp Task und zipDeploy
- task: AzureWebApp@1
  inputs:
    azureSubscription: 'AzureConnection'
    appName: 'az400-123456789-func1'
    package: '$(Build.ArtifactStagingDirectory)/functions.zip'
    deploymentMethod: 'zipDeploy'






