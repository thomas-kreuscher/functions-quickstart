trigger:
- master

pool:
  name: 'SelfHostedPool'
  # alternativ: vmImage: 'windows-latest' f√ºr Microsoft-hosted Agent

steps:
# Installiere .NET SDK 8.x (falls ben√∂tigt f√ºr Build/Tools)
- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    version: '8.x'

# Packe die Function-Dateien ins ZIP
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(System.DefaultWorkingDirectory)'
    includeRootFolder: false
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)/functions.zip'
    replaceExistingArchive: true

# üîß Debug-Check: Funktion App anzeigen
- task: AzureCLI@2
  inputs:
    azureSubscription: 'az400-functions-sp-connection'
    scriptType: 'ps'              # PowerShell statt bash
    scriptLocation: 'inlineScript'
    inlineScript: |
      Write-Host "üîç Debug-Check: Function App anzeigen"
      az functionapp show `
        --name az400-123456789-func1-win `
        --resource-group az400-123456789-func1-win_group `
        --subscription 0666947c-aea5-4e1b-88ea-7e80580c95e8

# Deploy zur Function App
- task: AzureFunctionApp@1
  inputs:
    azureSubscription: 'az400-functions-sp-connection'
    appType: 'functionApp'
    appName: 'az400-123456789-func1-win'
    resourceGroupName: 'az400-123456789-func1-win_group'
    package: '$(Build.ArtifactStagingDirectory)/functions.zip'


