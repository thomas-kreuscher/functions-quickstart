trigger:
  branches:
    include:
      - master   # oder main

pool:
  name: SelfHostedPool

steps:
- script: echo "Deploying commit $(Build.SourceVersion) to Function App"
  displayName: 'Agent-Check'

# ZIP manuell erstellen: host.json + Funktionsordner direkt ins ZIP-Root
- powershell: |
    Add-Type -AssemblyName System.IO.Compression.FileSystem
    $source = "$(System.DefaultWorkingDirectory)"
    $destination = "$(Build.ArtifactStagingDirectory)\functions.zip"
    if (Test-Path $destination) { Remove-Item $destination }
    [System.IO.Compression.ZipFile]::CreateFromDirectory($source, $destination)
  displayName: 'Create ZIP with correct structure'

# Debug: ZIP-Inhalt pr√ºfen
- script: powershell -Command "Expand-Archive -Path $(Build.ArtifactStagingDirectory)/functions.zip -DestinationPath $(Build.ArtifactStagingDirectory)/unzipped; Get-ChildItem -Recurse $(Build.ArtifactStagingDirectory)/unzipped"
  displayName: 'Check ZIP contents'

# Deploy ins Azure Function App
- task: AzureFunctionApp@1
  inputs:
    azureSubscription: 'AzureConnection'
    appType: 'functionApp'
    appName: 'az400-123456789-func1'
    package: '$(Build.ArtifactStagingDirectory)/functions.zip'



